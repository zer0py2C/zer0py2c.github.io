	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>cuckoo3+kvm_win10沙箱部署过程 | zer0py2c个人博客</title>
  <meta name="author" content="zer0py2c">
  
  <meta name="description" content="本案例讲解如何在一台Ubuntu20.04的系统上安装Cuckoo3。由于博主技术水平有限，如果你在本地测试过程中发现存在BUG，纯属正常，感谢您的理解！！！（本案例講解如何在一台Ubuntu20.04的系統上安裝Cuckoo3。由於博主技術水平有限，如果你在本地測試過程中發現存在BUG，純屬正常，">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="cuckoo3+kvm_win10沙箱部署过程"/>
  <meta property="og:site_name" content="zer0py2c个人博客"/>

  
  
		<!-- favicon -->
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
		<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.png">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
    <!-- <link href="/favicon.ico" rel="icon"> -->
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

<meta name="generator" content="Hexo 6.3.0"></head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">zer0py2c个人博客</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="/about" title="关于作者">
                    <i class="fa fa-info-circle"></i>关于
                    </a>
                </li>
                
                <li>
                    <a href="/atom.xml" title="订阅源">
                    <i class="fa fa-rss"></i>RSS
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9 center-content">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>cuckoo3+kvm_win10沙箱部署过程</h2>
					
					<div>
						<span class="post-time">2023-08-30 17:01:45</span>
					</div>	
					

					<div class="article-content">
						<p>本案例讲解如何在一台Ubuntu20.04的系统上安装Cuckoo3。由于博主技术水平有限，如果你在本地测试过程中发现存在BUG，纯属正常，感谢您的理解！！！（本案例講解如何在一台Ubuntu20.04的系統上安裝Cuckoo3。由於博主技術水平有限，如果你在本地測試過程中發現存在BUG，純屬正常，感謝您的理解！ ！ ！）</p>
<h5 id="1-宿主机环境"><a href="#1-宿主机环境" class="headerlink" title="1.宿主机环境"></a>1.宿主机环境</h5><h6 id="1-1系统依赖"><a href="#1-1系统依赖" class="headerlink" title="1.1系统依赖"></a>1.1系统依赖</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo apt-get install libhyperscan5 libhyperscan-dev</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo apt-get install libjpeg8-dev zlib1g-dev p7zip-full rar unace-nonfree cabextract</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo apt-get install yara</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo apt-get install tcpdump apparmor-utils</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo aa-disable /usr/sbin/tcpdump</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">setcap</span> cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">getcap</span> /usr/sbin/tcpdump</span></span><br></pre></td></tr></table></figure>

<h6 id="1-2安装Cuckoo3"><a href="#1-2安装Cuckoo3" class="headerlink" title="1.2安装Cuckoo3"></a>1.2安装Cuckoo3</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 --version <span class="comment"># 3.8.10</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/cert-ee/cuckoo3.git</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> cuckoo3-main &amp;&amp; ./install.sh</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cuckoo createcwd</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cuckoo getmonitor cuckoo3-main/monitor.zip</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">unzip monitor.zip -d ~/.cuckoocwd/</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">unzip signatures.zip -d ~/.cuckoocwd/signatures/cuckoo/</span></span><br></pre></td></tr></table></figure>

<h6 id="1-3更新配置项"><a href="#1-3更新配置项" class="headerlink" title="1.3更新配置项"></a>1.3更新配置项</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ~/.cuckoocwd/conf/cuckoo.yaml</span></span><br><span class="line"><span class="attr">machineries:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kvm</span></span><br><span class="line"><span class="attr">resultserver:</span></span><br><span class="line">  <span class="attr">listen_ip:</span> <span class="number">192.168</span><span class="number">.156</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">listen_port:</span> <span class="number">2042</span></span><br><span class="line"><span class="attr">tcpdump:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">True</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/usr/sbin/tcpdump</span></span><br><span class="line"><span class="attr">network_routing:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">False</span></span><br><span class="line">  <span class="attr">rooter_socket:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">platform:</span></span><br><span class="line">  <span class="attr">autotag:</span> <span class="literal">False</span></span><br><span class="line"><span class="attr">state_control:</span></span><br><span class="line">  <span class="attr">cancel_unidentified:</span> <span class="literal">False</span></span><br><span class="line"><span class="attr">processing:</span></span><br><span class="line">  <span class="attr">worker_amount:</span></span><br><span class="line">    <span class="attr">identification:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">pre:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">post:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">remote_storage:</span></span><br><span class="line">  <span class="attr">api_url:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">api_key:</span> <span class="literal">null</span></span><br><span class="line"><span class="comment"># ~/.cuckoocwd/conf/analysissettings.yaml</span></span><br><span class="line"><span class="attr">limits:</span></span><br><span class="line">  <span class="attr">max_timeout:</span> <span class="number">300</span></span><br><span class="line">  <span class="attr">max_priority:</span> <span class="number">999</span></span><br><span class="line">  <span class="attr">max_platforms:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">default:</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">60</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">route:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">options:</span></span><br><span class="line"><span class="attr">platform:</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">    <span class="attr">windows:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10</span></span><br><span class="line"><span class="comment"># ~/.cuckoocwd/conf/machineries/kvm.yaml</span></span><br><span class="line"><span class="attr">dsn:</span> <span class="string">&quot;qemu:///system&quot;</span></span><br><span class="line"><span class="attr">interface:</span> <span class="string">virbr1</span></span><br><span class="line"><span class="attr">machines:</span></span><br><span class="line">  <span class="attr">win10_64bit_001:</span></span><br><span class="line">    <span class="attr">label:</span> <span class="string">win10_64bit_001</span></span><br><span class="line">    <span class="attr">ip:</span> <span class="number">192.168</span><span class="number">.156</span><span class="number">.101</span></span><br><span class="line">    <span class="attr">platform:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">os_version:</span> <span class="string">&quot;10&quot;</span></span><br><span class="line">    <span class="attr">architecture:</span> <span class="string">amd64</span></span><br><span class="line">    <span class="attr">agent_port:</span> <span class="number">8000</span></span><br><span class="line">    <span class="attr">mac_address:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">snapshot:</span> <span class="string">win10_64bit_001_snapshot1</span></span><br><span class="line">    <span class="attr">interface:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pdfreader</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">java</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">python</span></span><br></pre></td></tr></table></figure>

<h6 id="1-4配置iptables规则"><a href="#1-4配置iptables规则" class="headerlink" title="1.4配置iptables规则"></a>1.4配置iptables规则</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo iptables -t nat -A POSTROUTING -o ens33 -s 192.168.156.0/24 -j MASQUERADE</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo iptables -P FORWARD DROP</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo iptables -A FORWARD -s 192.168.156.0/24 -j ACCEPT</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo iptables -A FORWARD -s 192.168.156.0/24 -d 192.168.156.0/24 -j ACCEPT</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo iptables -A FORWARD -j LOG</span></span><br></pre></td></tr></table></figure>

<h6 id="1-5启动Web服务"><a href="#1-5启动Web服务" class="headerlink" title="1.5启动Web服务"></a>1.5启动Web服务</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pip install uwsgi</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo apt-get install uwsgi uwsgi-plugin-python3 nginx -y</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cuckoo web generateconfig --uwsgi &gt; cuckoo-web.ini</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">mv</span> cuckoo-web.ini /etc/uwsgi/apps-available/</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">ln</span> -s /etc/uwsgi/apps-available/cuckoo-web.ini /etc/uwsgi/apps-enabled/cuckoo-web.ini</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo adduser www-data <span class="variable">$USER</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cuckoo web djangocommand collectstatic</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim ~/.cuckoocwd/web/web_local_settings.py <span class="comment"># STATIC_ROOT = &quot;/opt/cuckoo3/web/cuckoo/web/static&quot;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cuckoo web generateconfig --nginx &gt; cuckoo-web.conf</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim cuckoo-web.conf <span class="comment"># listen 80;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">mv</span> cuckoo-web.conf /etc/nginx/sites-available/cuckoo-web.conf</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/cuckoo-web.conf /etc/nginx/sites-enabled/cuckoo-web.conf</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">rm</span> /etc/nginx/sites-enabled/default</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo systemctl restart nginx uwsgi</span></span><br></pre></td></tr></table></figure>

<h6 id="1-6启动Cuckoo3"><a href="#1-6启动Cuckoo3" class="headerlink" title="1.6启动Cuckoo3"></a>1.6启动Cuckoo3</h6><p>参考<code>https://github.com/cert-ee/cuckoo3/pull/49</code>修改源码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cuckoo --debug</span></span><br></pre></td></tr></table></figure>



<h5 id="2-客户机环境"><a href="#2-客户机环境" class="headerlink" title="2.客户机环境"></a>2.客户机环境</h5><h6 id="2-1安装操作系统"><a href="#2-1安装操作系统" class="headerlink" title="2.1安装操作系统"></a>2.1安装操作系统</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">virt-install --accelerate --virt-type=kvm --os-variant=win10 \</span></span><br><span class="line"><span class="language-bash">  --ram=4096 --vcpus sockets=1,cores=1,threads=1 --network network=isolated --name win10_64bit_001 \</span></span><br><span class="line"><span class="language-bash">  --disk path=/home/zer0py2c/win10_64bit_001.qcow2,size=30,bus=virtio,format=qcow2 \</span></span><br><span class="line"><span class="language-bash">  --disk path=/home/zer0py2c/virtio-win-0.1.173.iso,device=cdrom \</span></span><br><span class="line"><span class="language-bash">  --cdrom=/home/zer0py2c/Win10_1703_English_x64.iso \</span></span><br><span class="line"><span class="language-bash">  --graphics vnc,listen=0.0.0.0,port=5910,password=123456 --connect qemu:///system --noautoconsole</span></span><br></pre></td></tr></table></figure>

<h6 id="2-2更改适配器选项"><a href="#2-2更改适配器选项" class="headerlink" title="2.2更改适配器选项"></a>2.2更改适配器选项</h6><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ipv4</span>=<span class="number">192.168</span>.<span class="number">156.101</span></span><br><span class="line"><span class="attr">netmask</span>=<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line"><span class="attr">gateway</span>=<span class="number">192.168</span>.<span class="number">156.1</span></span><br><span class="line"><span class="attr">dns_server1</span>=<span class="number">192.168</span>.<span class="number">156.1</span></span><br><span class="line"><span class="attr">dns_server2</span>=<span class="number">114.114</span>.<span class="number">114.114</span></span><br></pre></td></tr></table></figure>

<h6 id="2-3禁用补丁防护模式"><a href="#2-3禁用补丁防护模式" class="headerlink" title="2.3禁用补丁防护模式"></a>2.3禁用补丁防护模式</h6><p>以管理员身份运行<code>patch.exe</code>，md5：<code>440474c5a51af6d16a193db1d0066b04</code>，执行完毕后重启，选择以<code>Patch Guard disabled</code>模式进入系统。</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 客户机依赖文件清单</span></span><br><span class="line">AdbeRdr90<span class="emphasis">_zh_</span>CN.exe,agent.zip,BANDIZIP-SETUP.EXE,jdk-8u281-windows-x64.exe,Office2013(64位VOL版)+激活工具.rar,patch.exe,python-2.7.17.msi,vc<span class="emphasis">_redist.x64.exe,disable_</span>services.ps1,optimize<span class="emphasis">_settings.ps1</span></span><br></pre></td></tr></table></figure>

<h6 id="2-4禁用服务"><a href="#2-4禁用服务" class="headerlink" title="2.4禁用服务"></a>2.4禁用服务</h6><ul>
<li>禁用防火墙、UAC、Windows Defender、PCA Service</li>
<li>禁用管理员权限限制（<a target="_blank" rel="noopener" href="https://blog.csdn.net/yanhanhui1/article/details/82746357%EF%BC%89">https://blog.csdn.net/yanhanhui1/article/details/82746357）</a></li>
<li>禁用其他服务（powershell -ExecutionPolicy bypass -File disable_services.ps1）</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># disable_services.ps1</span></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Disabling all non-vital Windows 10 services&quot;</span></span><br><span class="line"><span class="variable">$errs</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">Foreach</span> (<span class="variable">$servicename</span> <span class="keyword">in</span> (<span class="string">&quot;PrintNotify&quot;</span>, <span class="string">&quot;WpnUserService&quot;</span>, <span class="string">&quot;OneSyncSvc&quot;</span>, <span class="string">&quot;WdBoot&quot;</span>, <span class="string">&quot;WdFilter&quot;</span>, <span class="string">&quot;WdNisDrv&quot;</span>, <span class="string">&quot;WdNisSvc&quot;</span>, <span class="string">&quot;WinDefend&quot;</span>, <span class="string">&quot;DiagTrack&quot;</span>, <span class="string">&quot;DoSvc&quot;</span>, <span class="string">&quot;TimeBrokerSvc&quot;</span>, <span class="string">&quot;TokenBroker&quot;</span>, <span class="string">&quot;Sense&quot;</span>, <span class="string">&quot;SecurityHealthService&quot;</span>, <span class="string">&quot;wscsvc&quot;</span>, <span class="string">&quot;dmwappushservice&quot;</span>, <span class="string">&quot;AJRouter&quot;</span>, <span class="string">&quot;ALG&quot;</span>, <span class="string">&quot;AppMgmt&quot;</span>, <span class="string">&quot;bthserv&quot;</span>, <span class="string">&quot;PeerDistSvc&quot;</span>, <span class="string">&quot;CertPropSvc&quot;</span>, <span class="string">&quot;dmwappushservice&quot;</span>, <span class="string">&quot;MapsBroker&quot;</span>, <span class="string">&quot;Fax&quot;</span>, <span class="string">&quot;lfsvc&quot;</span>, <span class="string">&quot;HvHost&quot;</span>, <span class="string">&quot;vmickvpexchange&quot;</span>, <span class="string">&quot;vmicguestinterface&quot;</span>, <span class="string">&quot;vmicshutdown&quot;</span>, <span class="string">&quot;vmicheartbeat&quot;</span>, <span class="string">&quot;vmicvmsession&quot;</span>, <span class="string">&quot;vmicrdv&quot;</span>, <span class="string">&quot;vmictimesync&quot;</span>, <span class="string">&quot;vmicvss&quot;</span>, <span class="string">&quot;irmon&quot;</span>, <span class="string">&quot;SharedAccess&quot;</span>, <span class="string">&quot;iphlpsvc&quot;</span>, <span class="string">&quot;IpxlatCfgSvc&quot;</span>, <span class="string">&quot;MSiSCSI&quot;</span>, <span class="string">&quot;SmsRouter&quot;</span>, <span class="string">&quot;NaturalAuthentication&quot;</span>, <span class="string">&quot;NetTcpPortSharing&quot;</span>, <span class="string">&quot;Netlogon&quot;</span>, <span class="string">&quot;NcdAutoSetup&quot;</span>, <span class="string">&quot;CscService&quot;</span>, <span class="string">&quot;SEMgrSvc&quot;</span>, <span class="string">&quot;PhoneSvc&quot;</span>, <span class="string">&quot;SessionEnv&quot;</span>, <span class="string">&quot;TermService&quot;</span>, <span class="string">&quot;UmRdpService&quot;</span>, <span class="string">&quot;RpcLocator&quot;</span>, <span class="string">&quot;RetailDemo&quot;</span>, <span class="string">&quot;SensorDataService&quot;</span>, <span class="string">&quot;SensrSvc&quot;</span>, <span class="string">&quot;SensorService&quot;</span>, <span class="string">&quot;ScDeviceEnum&quot;</span>, <span class="string">&quot;SCPolicySvc&quot;</span>, <span class="string">&quot;SNMPTRAP&quot;</span>, <span class="string">&quot;TabletInputService&quot;</span>, <span class="string">&quot;WebClient&quot;</span>, <span class="string">&quot;FrameServer&quot;</span>, <span class="string">&quot;wcncsvc&quot;</span>, <span class="string">&quot;wisvc&quot;</span>, <span class="string">&quot;WMPNetworkSvc&quot;</span>, <span class="string">&quot;icssvc&quot;</span>, <span class="string">&quot;WinRM&quot;</span>, <span class="string">&quot;workfolderssvc&quot;</span>, <span class="string">&quot;WwanSvc&quot;</span>, <span class="string">&quot;XblAuthManager&quot;</span>, <span class="string">&quot;XblGameSave&quot;</span>, <span class="string">&quot;XboxNetApiSvc&quot;</span>, <span class="string">&quot;WFDSConMgrSvc&quot;</span>)) &#123;</span><br><span class="line"><span class="keyword">If</span> (<span class="built_in">Test-Path</span> HKLM:\SYSTEM\CurrentControlSet\Services\<span class="variable">$servicename</span>) &#123;</span><br><span class="line">    <span class="variable">$shhh</span> = reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\<span class="variable">$servicename</span>&quot;</span> /v <span class="string">&quot;Start&quot;</span> /t REG_DWORD /d <span class="number">4</span> /f</span><br><span class="line">    <span class="variable">$start</span> = (<span class="built_in">Get-ItemProperty</span> <span class="literal">-Path</span> HKLM:\SYSTEM\CurrentControlSet\Services\<span class="variable">$servicename</span> <span class="literal">-ErrorAction</span> SilentlyContinue).Start</span><br><span class="line">    <span class="keyword">If</span> (<span class="variable">$start</span> <span class="operator">-ne</span> <span class="string">&quot;4&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">Write-Host</span> <span class="string">&quot;Failed to disable service <span class="variable">$servicename</span>&quot;</span></span><br><span class="line">      <span class="variable">$errs</span> += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> (<span class="variable">$errs</span> <span class="operator">-ne</span> <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="2-5安装依赖软件"><a href="#2-5安装依赖软件" class="headerlink" title="2.5安装依赖软件"></a>2.5安装依赖软件</h6><table>
<thead>
<tr>
<th align="center">依赖软件</th>
<th align="center">版本&#x2F;md5</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Python</td>
<td align="center">2.7.17</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Jdk</td>
<td align="center">8u281</td>
<td align="center">必须安装vc_redist.x64.exe</td>
</tr>
<tr>
<td align="center">Adobe Reader</td>
<td align="center">9.0.0</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Microsoft Office</td>
<td align="center">2013</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">BANDIZIP</td>
<td align="center">6.22</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">agent.pyw</td>
<td align="center">07fc380d3570470eee75d57c4e2b31dc</td>
<td align="center">必需以管理员身份运行</td>
</tr>
</tbody></table>
<h6 id="2-6优化Windows10配置（可选）"><a href="#2-6优化Windows10配置（可选）" class="headerlink" title="2.6优化Windows10配置（可选）"></a>2.6优化Windows10配置（可选）</h6><p>powershell -ExecutionPolicy bypass -File optimize_settings.ps1</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># optimize_settings.ps1</span></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Optimizing windows 10 settings&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### Applications</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove all preinstalled applications that are not dependencies</span></span><br><span class="line"><span class="variable">$packageCount</span> = (<span class="built_in">Get-AppxPackage</span>).Count</span><br><span class="line"><span class="built_in">Get-AppxPackage</span> <span class="literal">-allusers</span> | <span class="built_in">Remove-AppxPackage</span> <span class="literal">-ErrorAction</span> SilentlyContinue</span><br><span class="line"><span class="variable">$packageCount</span> -= (<span class="built_in">Get-AppxPackage</span>).Count</span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Removed <span class="variable">$packageCount</span> optional AppX packages&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove OneDrive</span></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Removing OneDrive&quot;</span></span><br><span class="line"><span class="built_in">Get-Process</span> *onedrive* | <span class="built_in">stop-process</span></span><br><span class="line"><span class="built_in">Start-Process</span> <span class="string">&quot;<span class="variable">$</span>&#123;Env:WinDir&#125;\SysWOW64\OneDriveSetup.exe&quot;</span> <span class="literal">-ArgumentList</span> <span class="string">&quot;/uninstall&quot;</span> <span class="literal">-Wait</span></span><br><span class="line"><span class="variable">$onedrivePath</span> = <span class="string">&quot;<span class="variable">$</span>&#123;Env:LOCALAPPDATA&#125;\Microsoft\OneDrive&quot;</span></span><br><span class="line"><span class="built_in">Get-Process</span> *onedrive* | <span class="built_in">stop-process</span></span><br><span class="line"><span class="built_in">remove-item</span> <span class="variable">$onedrivePath</span> <span class="literal">-Force</span> <span class="literal">-Recurse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove OneDrive startup key</span></span><br><span class="line"><span class="keyword">If</span> ((<span class="built_in">Get-ItemProperty</span> <span class="string">&quot;HKCU:\Software\Microsoft\Windows\CurrentVersion\Run&quot;</span>).OneDriveSetup) &#123;</span><br><span class="line">  reg delete <span class="string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run&quot;</span> /v OneDriveSetup /f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### Security</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Further disabling Windows Defender and Firewall&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable smartscreen</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\System&quot;</span> /v EnableSmartScreen /t REG_DWORD /d <span class="number">0</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\MicrosoftEdge\PhishingFilter&quot;</span> /v Enabledv9 /t REG_DWORD /d <span class="number">0</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer&quot;</span> /v <span class="string">&quot;SmartScreenEnabled&quot;</span> /t <span class="string">&quot;REG_SZ&quot;</span> /d <span class="string">&quot;Off&quot;</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\AppHost&quot;</span> /v <span class="string">&quot;SmartScreenEnabled&quot;</span> /t <span class="string">&quot;REG_SZ&quot;</span> /d <span class="string">&quot;Off&quot;</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\AppHost&quot;</span> /v EnableWebContentEvaluation /t REG_DWORD /d <span class="number">0</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\AppHost&quot;</span> /v PreventOverride /t REG_DWORD /d <span class="number">0</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Further disable Windows Defender</span></span><br><span class="line">reg add <span class="string">&quot;HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection&quot;</span> /v DisableRealtimeMonitoring /d <span class="number">1</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection&quot;</span> /v <span class="string">&quot;DisableBehaviorMonitoring&quot;</span> /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection&quot;</span> /v <span class="string">&quot;DisableOnAccessProtection&quot;</span> /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection&quot;</span> /v <span class="string">&quot;DisableScanOnRealtimeEnable&quot;</span> /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable biometrics</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Biometrics&quot;</span> /v <span class="string">&quot;Enabled&quot;</span> /t REG_DWORD /d <span class="number">0</span> /f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### Notifications</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable the action center (the hard way)</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$file</span> <span class="keyword">in</span> (<span class="string">&quot;<span class="variable">$Env:WinDir</span>\System32\ActionCenter.dll&quot;</span>, <span class="string">&quot;<span class="variable">$Env:WinDir</span>\System32\ActionCenterCPL.dll&quot;</span>)) &#123;</span><br><span class="line">  takeown /f <span class="variable">$file</span> | <span class="built_in">Out-Null</span></span><br><span class="line">  <span class="variable">$Acl</span> = <span class="built_in">Get-Acl</span> <span class="variable">$file</span></span><br><span class="line">  <span class="variable">$ownerName</span> = <span class="variable">$Acl</span>.Owner</span><br><span class="line">  <span class="variable">$Ar</span> = <span class="built_in">New-Object</span> system.security.accesscontrol.filesystemaccessrule(<span class="string">&quot;<span class="variable">$ownerName</span>&quot;</span>,<span class="string">&quot;FullControl&quot;</span>,<span class="string">&quot;Allow&quot;</span>)</span><br><span class="line">  <span class="variable">$Acl</span>.SetAccessRule(<span class="variable">$Ar</span>)</span><br><span class="line">  <span class="built_in">Set-Acl</span> <span class="variable">$file</span> <span class="variable">$Acl</span></span><br><span class="line">  <span class="built_in">Move-Item</span> <span class="variable">$file</span> <span class="string">&quot;<span class="variable">$</span>&#123;file&#125;_BUP&quot;</span> <span class="literal">-Force</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Disabling the Notification Center and other notifications&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable the notification center</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Explorer&quot;</span> /v <span class="string">&quot;DisableNotificationCenter&quot;</span> /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable the Security and Maintenance toast notifications</span></span><br><span class="line">reg add <span class="string">&quot;HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Notifications\Settings\Windows.SystemToast.SecurityAndMaintenance&quot;</span> /v Enabled /t REG_DWORD /d <span class="number">0</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable windows defender notifications</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender\UX Configuration&quot;</span> /v <span class="string">&quot;Notification_Suppress&quot;</span> /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line">reg delete <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;</span> /v <span class="string">&quot;SecurityHealth&quot;</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable tips about Windows (might cause high cpu load)</span></span><br><span class="line">reg add <span class="string">&quot;HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ContentDeliveryManager&quot;</span> /v SoftLandingEnabled /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### Performance</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Optimizing Windows 10 performance&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable Windows app tracking to improve start and search results</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\EdgeUI&quot;</span> /v <span class="string">&quot;DisableMFUTracking&quot;</span> /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable maintenance</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\Maintenance&quot;</span> /v <span class="string">&quot;Activation Boundary&quot;</span> /t REG_SZ /d <span class="string">&quot;2001-01-01T16:00:00&quot;</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\Maintenance&quot;</span> /v <span class="string">&quot;MaintenanceDisabled&quot;</span> /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Skip the first logon animation</span></span><br><span class="line">reg add <span class="string">&quot;HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System&quot;</span> /v EnableFirstLogonAnimation /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;</span> /v EnableFirstLogonAnimation /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable admin approval mode</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System&quot;</span> /v FilterAdministratorToken /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\UIPI&quot;</span> /t REG_SZ /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Zero Startup Delay</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Serialize&quot;</span> /v <span class="string">&quot;Startupdelayinmsec&quot;</span> /t REG_DWORD /d <span class="number">0</span> /f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### Start menu</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;debloating start menu&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable live tiles</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\PushNotifications&quot;</span> /v NoTileApplicationNotification /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove all tiles from windows start layout</span></span><br><span class="line"><span class="variable">$startlayout</span> = <span class="string">&#x27;&lt;LayoutModificationTemplate xmlns:defaultlayout=&quot;http://schemas.microsoft.com/Start/2014/FullDefaultLayout&quot; xmlns:start=&quot;http://schemas.microsoft.com/Start/2014/StartLayout&quot; Version=&quot;1&quot; xmlns=&quot;http://schemas.microsoft.com/Start/2014/LayoutModification&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;LayoutOptions StartTileGroupCellWidth=&quot;6&quot; /&gt;</span></span><br><span class="line"><span class="string">  &lt;DefaultLayoutOverride&gt;</span></span><br><span class="line"><span class="string">    &lt;StartLayoutCollection&gt;</span></span><br><span class="line"><span class="string">      &lt;defaultlayout:StartLayout GroupCellWidth=&quot;6&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;start:Group Name=&quot;&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;start:DesktopApplicationTile Size=&quot;2x2&quot; Column=&quot;0&quot; Row=&quot;0&quot; DesktopApplicationLinkPath=&quot;%APPDATA%\Microsoft\Windows\Start Menu\Programs\nonexistingpath.lnk&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/start:Group&gt;</span></span><br><span class="line"><span class="string">      &lt;/defaultlayout:StartLayout&gt;</span></span><br><span class="line"><span class="string">    &lt;/StartLayoutCollection&gt;</span></span><br><span class="line"><span class="string">  &lt;/DefaultLayoutOverride&gt;</span></span><br><span class="line"><span class="string">&lt;/LayoutModificationTemplate&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$startLayoutPath</span> = <span class="string">&quot;<span class="variable">$</span>&#123;Env:USERPROFILE&#125;\layout.xml&quot;</span></span><br><span class="line"><span class="variable">$startlayout</span> | <span class="built_in">sc</span> <span class="variable">$startLayoutPath</span> <span class="literal">-encoding</span> Utf8</span><br><span class="line"><span class="built_in">Import-StartLayout</span> <span class="literal">-layoutpath</span> <span class="string">&quot;<span class="variable">$</span>&#123;Env:USERPROFILE&#125;\layout.xml&quot;</span> <span class="literal">-mountpath</span> C:\</span><br><span class="line"><span class="built_in">Remove-Item</span> <span class="variable">$startLayoutPath</span></span><br><span class="line"><span class="built_in">Remove-Item</span> <span class="string">&#x27;HKCU:\Software\Microsoft\Windows\CurrentVersion\CloudStore\Store\Cache\DefaultAccount\$start.tilegrid$windows.data.curatedtilecollection.root&#x27;</span> <span class="literal">-Force</span> <span class="literal">-Recurse</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### General</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Disabling diagnostics, feedback and telemetry&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Diagnostics and feedback</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\DataCollection&quot;</span> /v DoNotShowFeedbackNotifications /d <span class="number">1</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\System&quot;</span> /v EnableActivityFeed /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\System&quot;</span> /v PublishUserActivities /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\System&quot;</span> /v UploadUserActivities /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not collect/send data</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\AdvertisingInfo&quot;</span> /v Enabled /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced&quot;</span> /v Start_TrackProgs /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable license telemetry</span></span><br><span class="line">reg add <span class="string">&quot;HKLM\Software\Policies\Microsoft\Windows NT\CurrentVersion\Software Protection Platform&quot;</span> /v <span class="string">&quot;NoGenTicket&quot;</span> /t <span class="string">&quot;REG_DWORD&quot;</span> /d <span class="string">&quot;1&quot;</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable windows feedback</span></span><br><span class="line">reg add <span class="string">&quot;HKCU\SOFTWARE\Microsoft\Siuf\Rules&quot;</span> /v <span class="string">&quot;NumberOfSIUFInPeriod&quot;</span> /t <span class="string">&quot;REG_DWORD&quot;</span> /d <span class="string">&quot;0&quot;</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inking and typing personalization</span></span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\Software\Microsoft\InputPersonalization&quot;</span> /v RestrictImplicitInkCollection /d <span class="number">1</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\SOFTWARE\Microsoft\Personalization\Settings&quot;</span> /v AcceptedPrivacyPolicy /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\SOFTWARE\Microsoft\InputPersonalization\TrainedDataStore&quot;</span> /v HarvestContacts /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\SOFTWARE\Microsoft\InputPersonalization&quot;</span> /v RestrictImplicitTextCollection /d <span class="number">1</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Speech_OneCore\Preferences&quot;</span> /v ModelDownloadAllowed /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\TabletPC&quot;</span> /v PreventHandwritingDataSharing /d <span class="number">1</span> /t REG_DWORD /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\HandwritingErrorReports&quot;</span> /v PreventHandwritingErrorReports /d <span class="number">1</span> /t REG_DWORD /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable Windows tips</span></span><br><span class="line">reg add <span class="string">&quot;HKLM\Software\Policies\Microsoft\Windows\CloudContent&quot;</span> /v <span class="string">&quot;DisableSoftLanding&quot;</span> /t <span class="string">&quot;REG_DWORD&quot;</span> /d <span class="string">&quot;1&quot;</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKLM\Software\Policies\Microsoft\Windows\CloudContent&quot;</span> /v <span class="string">&quot;DisableWindowsSpotlightFeatures&quot;</span> /t <span class="string">&quot;REG_DWORD&quot;</span> /d <span class="string">&quot;1&quot;</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not automatically download apps</span></span><br><span class="line">reg add <span class="string">&quot;HKLM\Software\Policies\Microsoft\Windows\CloudContent&quot;</span> /v <span class="string">&quot;DisableWindowsConsumerFeatures&quot;</span> /t <span class="string">&quot;REG_DWORD&quot;</span> /d <span class="string">&quot;1&quot;</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not offer to provide feedback</span></span><br><span class="line">reg add <span class="string">&quot;HKLM\Software\Policies\Microsoft\Windows\DataCollection&quot;</span> /v <span class="string">&quot;DoNotShowFeedbackNotifications&quot;</span> /t <span class="string">&quot;REG_DWORD&quot;</span> /d <span class="string">&quot;1&quot;</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Skip the &#x27;keep using this app&#x27; file assocation dialog</span></span><br><span class="line">reg add HKCU\SOFTWARE\Policies\Microsoft\Windows\Explorer /v NoNewAppAlert /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable KMS connection broker (SppExtComObj.exe)</span></span><br><span class="line">reg add <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SoftwareProtectionPlatform&quot;</span> /v DisableDnsPublishing /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable Cortana</span></span><br><span class="line">reg add <span class="string">&quot;HKLM\SOFTWARE\Policies\Microsoft\Windows\Windows Search&quot;</span> /v AllowCortana /d <span class="number">0</span> /t REG_DWORD /f</span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove Edge from the taskbar</span></span><br><span class="line">((<span class="built_in">New-Object</span> <span class="literal">-Com</span> Shell.Application).NameSpace(<span class="string">&#x27;shell:::&#123;4234d49b-0245-4df3-b780-3893943456e1&#125;&#x27;</span>).Items() | ?&#123;<span class="variable">$_</span>.Name <span class="operator">-match</span> <span class="string">&quot;Edge&quot;</span>&#125;).Verbs() | ?&#123;<span class="variable">$_</span>.Name.replace(<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;&#x27;</span>) <span class="operator">-match</span> <span class="string">&#x27;Unpin from taskbar&#x27;</span>&#125; | %&#123;<span class="variable">$_</span>.DoIt(); <span class="variable">$exec</span> = <span class="variable">$true</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable Diagnostic Policy Service (problem detection, troubleshooting and resolution, cannot be disabled after reboot)</span></span><br><span class="line"><span class="built_in">Set-Service</span> DPS <span class="literal">-StartupType</span> disabled</span><br></pre></td></tr></table></figure>

<h6 id="2-7生成快照并关机"><a href="#2-7生成快照并关机" class="headerlink" title="2.7生成快照并关机"></a>2.7生成快照并关机</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo virsh snapshot-create-as win10_64bit_001 win10_64bit_001_snapshot1 --description <span class="string">&quot;Patch Guard disabled&quot;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo virsh shutdown --domain win10_64bit_001</span></span><br></pre></td></tr></table></figure>

					</div>

			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  

		<div class="comment-section">
  
  


</div>
	</div>

	

</div>


		<footer>
			

<p>
  由 <a target="_blank" rel="noopener" href="https://hexo.io">hexo</a> 强力驱动 | 搭载 <a target="_blank" rel="noopener" href="https://github.com/wayou/hexo-theme-material">material</a> 主题
</p>
<p>
  &copy; 2023 <a href="http://example.com"> zer0py2c </a>
</p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
